var BookSearch=function(){var lib=lib?lib:{};lib.init=function(a){function c(a,b){b&&(lib.config[a]=b)}function d(a){lib.app.addMerchants(a)}c("apiKey",a.apiKey),c("bookImageSmall",a.bookImageSmall),c("bookImageLarge",a.bookImageLarge),lib.api.init(lib.config.apiKey,lib.config.bookImageSmall,lib.config.bookImageLarge);var b=lib.api;b.merchants(d),new lib.controller.MainPage(a.container)};var JSON;JSON||(JSON={}),function(){function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";return e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g,e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)typeof rep[c]=="string"&&(d=rep[c],e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));return e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g,e}}"use strict",typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number")return str("",{"":a});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),lib.util={};var util=lib.util;util.extendNamespace=function(a){var b=a.split("."),c=lib,d,e;b[0]==="lib"&&(b=b.slice(1)),d=b.length;for(e=0;e<d;e++)typeof c[b[e]]=="undefined"&&(c[b[e]]={}),c=c[b[e]];return c},util.empty=function(a){return a===undefined||a===null||a==""},util.bind=function(a,b){return function(){return b.apply(a,arguments)}};var initializing=!1,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;lib.Class=function(){},lib.Class.extend=function(a){function e(){!initializing&&this.init&&this.init.apply(this,arguments)}var b=this.prototype;initializing=!0;var c=new this;initializing=!1;for(var d in a)c[d]=typeof a[d]=="function"&&typeof b[d]=="function"&&fnTest.test(a[d])?function(a,c){return function(){var d=this._super;this._super=b[a];var e=c.apply(this,arguments);return this._super=d,e}}(d,a[d]):a[d];return e.prototype=c,e.prototype.constructor=e,e.extend=arguments.callee,e};var constants=lib.util.extendNamespace("constants");constants.Condition={NEW:0,USED:1,EBOOK:2,RENTAL:3},constants.domPrefix="bs-",constants.scrollBar={minHandleSize:50,mouseWheelSpeed:50},constants.css={twoColumnView:"two_column_view",twoColumnViewColumn:"two_column_view_column",twoColumnViewShifter:"two_column_view_shifter",twoColumnViewSwitchButton:"two_column_view_switch_button",selected:"selected",imageBox:"image_box",bookImage:"book_img",bookSizeSmall:"book_img_small",bookSizeLarge:"book_img_large",list:"list",listBooks:"list_books",emptyIndicator:"empty_indicator",empty:"empty",loading:"loading",listItem:"list_item",listItemFade:"list_item_fade",listTextDark:"list_text_dark",listTextMedium:"list_text_medium",listTextLight:"list_text_light",listBookItem:"list_book_item",listBookItemTitle:"list_book_item_title",listBookItemMetaText:"list_book_item_meta_text",listLoadMore:"list_load_more",listOfferItem:"list_offer_item",listOfferItemImage:"list_offer_item_image",listOfferItemPrice:"list_offer_item_price",listOfferItemShipping:"list_offer_item_shipping",tabView:"tab_view",tabWell:"tab_well",tabContentContainer:"tab_content_container",tabButton:"tab_button",tabContent:"tab_content",bookDetails:"book_details",bookDetailsImageWell:"book_details_image_well",bookDetailsData:"book_details_data",bookDetailsTitle:"book_details_title",bookDetailsRow:"book_details_row",bookDetailsLabel:"book_details_label",bookDetailsText:"book_details_text",scrollBarParent:"scroll_bar_parent",scrollBarGutter:"scroll_bar_gutter",scrollBarHandle:"scroll_bar_handle",keywordInput:"keyword_input",keywordInputForm:"keyword_input_form",keywordInputTextField:"keyword_input_text_field",keywordInputTextFieldWrapper:"keyword_input_text_field_wrapper",keywordInputSubmit:"keyword_input_submit"},constants.strings={bookMetaNames:{author:"Author",isbn10:"ISBN10",isbn13:"ISBN13",binding:"Binding",msrp:"MSRP",pages:"Pages",publisher:"Publisher",publishedDate:"Published",edition:"Edition"},listBookLabels:{loadMore:"Load More",emptyList:"No Books to Display"},tabLabels:{empty:"No Book to Display",pricesEmpty:"No Prices Found"},listOffersLabels:{emptyList:"No Prices Found",totalPrice:"Total Price",shipping:"shipping"},keywordInput:{defaultText:"Title, Author, ISBN, Keywords",submit:"Search"}},constants.resources={images:{ajaxLoaderOnWhite:"img/loader-on-white.gif"}};var config=lib.util.extendNamespace("config");config.apiKey="T4C4ZN2TtXhaUfq0Hq6z",config.bookImageSmall=66,config.bookImageLarge=130;var dom=lib.util.extendNamespace("dom");dom.create=function(a){var b=a.options,c=a.tag,d=a.css,e=a.text,f=a.children,g=a.jquery,h=$("<"+c+"></"+c+">");if(b)for(var i in b){var j=b[i];i=="domClass"&&(i="class");if(i=="class"||i=="id")if(j instanceof Array)for(var k=0;k<j.length;k++)j[k]=lib.constants.domPrefix+j[k];else j=lib.constants.domPrefix+j;if(j instanceof Array){var l="";for(var m=0;m<j.length;m++)l+=j[m]+" ";j=l}h.attr(i,j)}d&&h.css(d),e&&h.text(e);if(f)if(f instanceof Array)for(var n in f)h.append(f[n]);else h.append(f);return g?h:h.get(0)},dom.addClass=function(a,b){$(a).addClass(lib.constants.domPrefix+b)},dom.removeClass=function(a,b){$(a).removeClass(lib.constants.domPrefix+b)},dom.setId=function(a,b){b||(b=""),$(a).attr("id",lib.constants.domPrefix+b)},dom.click=function(a,b){lib.app.mobile?console.log("mobile not implemented yet"):$(a).click(b)},dom.onClick=function(a,b,c){var d="click";lib.app.mobile&&console.log("mobile not implemented yet"),$(a).on(d,"li",c)};var app=lib.util.extendNamespace("app"),merchants={},useStorage=window.localStorage===undefined?!1:!0;if(useStorage){var tmp=JSON.parse(localStorage.getItem("merchants"));merchants=tmp===null?merchants:tmp}app.mobile=!1,app.addMerchants=function(a){if(a.status){var b=a.data,c=!1;for(var d=0;d<b.length;d++){var e=b[d];merchants[e.id]===undefined&&(merchants[e.id]=e,c=!0)}useStorage&&c&&localStorage.setItem("merchants",JSON.stringify(merchants))}},app.getMerchant=function(a){return merchants[a]};var api=lib.util.extendNamespace("api");api.API_KEY=null,api.IMG_SIZE_SM=null,api.IMG_SIZE_LG=null,api.BASE_URL="http://api2.campusbooks.com/12/rest/",api.init=function(a,b,c){api.API_KEY=a,api.IMG_SIZE_SM=b,api.IMG_SIZE_LG=c,this._requestId=0},api.bookPrices=function(a,b){return api._genericSystem("prices",{isbn:a},api._bookPrices,b,2e4)},api.bookInfo=function(a,b,c){return api._genericSystem("search",{keywords:a,page:1,image_height:b},api._bookInfo,c,1e4,b)},api.search=function(a,b,c,d){return api._genericSystem("search",{keywords:a,page:c,image_height:b},api._search,d,1e4)},api.merchants=function(a){return api._genericSystem("merchants",{coupons:""},api._merchants,a,15e3)},api._bookPrices=function(a){if(a.offers===undefined)return null;var b=new lib.model.BookOffers(a.offers.condition);return b},api._bookInfo=function(a,b){if(a.results===undefined)return null;var c=a.results.book;if(c.length==0)return null;var d=new lib.model.Book(c[0]);return b==api.IMG_SIZE_LG&&(d.imageLarge=d.imageSmall,d.imageSmall=null),d},api._bookInfoHelper=function(a){return a.book===undefined?null:new lib.model.Book(a.book)},api._search=function(a){if(a.results==undefined)return null;var b={pages:parseInt(a.pages),page:parseInt(a.current_page)},c=[],d=a.results.book;for(var e=0;e<d.length;e++)c.push(new lib.model.Book(d[e]));return b.books=c,b},api._bookPricesAndInfo=function(a){var b=this._bookInfoHelper(a);return b==null?null:(b.offers=this._bookPrices(a),b)},api._merchants=function(a){var b=[];for(var c=0;c<a.merchant.length;c++)b.push(new lib.model.Merchant(a.merchant[c]));return b},api._genericSystem=function(a,b,c,d,e,f){var g=this._requestId++;return this._buildQuery(a,b,function(a,b){var e={status:!0,data:null,id:g};b!=="success"||a.response["@attributes"].status!=="ok"?e.status=!1:e.data=c(a.response.page,f),d(e)},e),g},api._buildQuery=function(a,b,c,d){var e=this.BASE_URL+a+"?";e+="key="+this.API_KEY+"&format=json";for(var f in b)b.hasOwnProperty(f)&&(e+="&"+f+"="+b[f]);return this._loadQuery(e,c,d)},api._loadQuery=function(a,b,c){$.ajax({url:a,dataType:"jsonp",data:"",success:b,error:b,timeout:c})};var model=lib.util.extendNamespace("model");model.APIObject=lib.Class.extend({loadProperties:function(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=a[c],e=b[c]!==null?b[c]:c;d===""||d===undefined?this[e]=null:this[e]=d}}});var model=lib.util.extendNamespace("model");model.Book=model.APIObject.extend({init:function(a){var b={isbn10:null,isbn13:null,title:null,author:null,binding:null,msrp:null,pages:null,publisher:null,published_date:"publishedDate",edition:null,image:"imageSmall"};this.loadProperties(a,b),this.offers=null,this.imageLarge=null}});var model=lib.util.extendNamespace("model");model.BookOffers=lib.Class.extend({init:function(a){function f(a,b){return a=a.total_price,b=b.total_price,a>b?1:a<b?-1:0}this.types=[[],[],[],[]];for(var b=0;b<a.length;b++){var c=a[b],d=this.getOfferCondition(c["@attributes"].id);if(d!==undefined)for(var e=0;e<c.offer.length;e++)this.types[d].push(new model.Offer(c.offer[e]))}for(b=0;b<this.types.length;b++)this.types[b].sort(f);return this},getOfferCondition:function(a){var b=lib.constants.Condition;return a==1?b.NEW:a==0||a==2||a==4||a==7?b.USED:a==5?b.EBOOK:a==6?b.RENTAL:b.USED}});var model=lib.util.extendNamespace("model");model.Merchant=model.APIObject.extend({init:function(a){var b={image:null,merchant_id:"id",name:null};this.loadProperties(a,b);var c=a.coupons.coupon;c!==undefined?this.coupons=c:this.coupons=null}});var model=lib.util.extendNamespace("model");model.Offer=model.APIObject.extend({init:function(a){var b={condition_id:"conditionId",link:null,merchant_id:"merchant",price:null,shipping_ground:"shippingPrice",total_price:"totalPrice"};this.loadProperties(a,b),this.merchant=lib.app.getMerchant(this.merchant)}});var view=lib.util.extendNamespace("view");view.View=lib.Class.extend({build:function(){},redraw:function(){},getDomNode:function(){return this._container?this._container:null}});var view=lib.util.extendNamespace("view");view.ListItem=view.View.extend({init:function(a,b){a||(a=[]),this._container=lib.dom.create({tag:"li",options:{domClass:lib.constants.css.listItem},jquery:!0,children:a}),b&&this._addFadingEdge()},_addFadingEdge:function(){this.getDomNode().append(lib.dom.create({tag:"div",options:{domClass:lib.constants.css.listItemFade}}))},select:function(){lib.dom.addClass(this.getDomNode(),lib.constants.css.selected)},deselect:function(){lib.dom.removeClass(this.getDomNode(),lib.constants.css.selected)}});var view=lib.util.extendNamespace("view");view.ListItemBook=view.ListItem.extend({init:function(a){var b=lib.dom.create({tag:"div",options:{domClass:[lib.constants.css.imageBox,lib.constants.css.bookImage,lib.constants.css.bookSizeSmall]},css:{"background-image":'url("'+a.imageSmall+'")'}}),c=lib.dom.create({tag:"div",options:{domClass:[lib.constants.css.listBookItemTitle,lib.constants.css.listTextDark]},text:a.title}),d=lib.constants.strings.bookMetaNames,e=[d.author,d.isbn10,d.isbn13],f=[a.author,a.isbn10,a.isbn13],g=[b,c];for(var h=0;h<e.length;h++)if(!lib.util.empty(f[h])){var i=lib.dom.create({tag:"span",options:{domClass:lib.constants.css.listTextLight},text:e[h]+":"}),j=lib.dom.create({tag:"div",options:{domClass:[lib.constants.css.listBookItemMetaText,lib.constants.css.listTextMedium]},children:[i,f[h]]});g.push(j)}this._super(g,!0),lib.dom.addClass(this._container,lib.constants.css.listBookItem)}});var view=lib.util.extendNamespace("view");view.ListItemOffer=view.ListItem.extend({init:function(a){var b=lib.dom.create({tag:"div",options:{domClass:[lib.constants.css.listOfferItemImage,lib.constants.css.imageBox]},css:{"background-image":'url("'+a.merchant.image+'")'}}),c=lib.dom.create({tag:"div",options:{domClass:[lib.constants.css.listOfferItemPrice,lib.constants.css.listTextDark]},text:lib.constants.strings.listOffersLabels.totalPrice+": $"+a.totalPrice}),d=lib.dom.create({tag:"div",options:{domClass:[lib.constants.css.listOfferItemShipping,lib.constants.css.listTextMedium]},text:"$"+a.price+" + $"+a.shippingPrice+" "+lib.constants.strings.listOffersLabels.shipping});this._super([b,c,d]),lib.dom.addClass(this._container,lib.constants.css.listOfferItem)}});var view=lib.util.extendNamespace("view");view.ListView=view.View.extend({init:function(a){var b=this;this._elements=[],this._selectedIndex=null,this._loading=!1,this._clickCallback=a.clickCallback,this._footer=a.footer,this._scrollBar=null,this._container=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.list},jquery:!0}),this._list=lib.dom.create({tag:"ul",jquery:!0}),this._emptyIndicator=lib.dom.create({tag:"li",options:{domClass:lib.constants.css.emptyIndicator},text:a.emptyLabel,jquery:!0}),this._list.append(this._emptyIndicator),this._container.append(this._list),this._footer&&(this._list.append(this._footer),this._hideFooter()),lib.dom.onClick(this._list,"li",function(a){var c=$(this).index();b._listItemClick(c)}),a.scroll&&(this._scrollBar=new view.ScrollBar(this._container))},build:function(){this._scrollBar&&this._scrollBar.build()},redraw:function(){this._scrollBar&&this._scrollBar.redraw()},size:function(){return this._elements.length},addElements:function(a){this._elements.length===0&&(this._loading&&this.setLoading(!1),a.length!==0&&(this._hideEmptyIndicator(),this._showFooter()));for(var b in a)a.hasOwnProperty(b)&&(this._elements.push(a[b]),this._emptyIndicator.before(a[b].getDomNode()));this._scrollBar&&this._scrollBar.redraw()},clearElements:function(){this._elements=[],this._selectedIndex=null,this._footer?this._list.children().slice(0,-2).remove():this._list.children().slice(0,-1).remove(),this._hideFooter(),this._showEmptyIndicator(),this._scrollBar&&this._scrollBar.redraw()},setLoading:function(a){this._loading=a;var b;a?b=lib.dom.addClass:b=lib.dom.removeClass,b(this._container,lib.constants.css.loading)},_showFooter:function(){this._footer&&this._footer.css("display","block")},_hideFooter:function(){this._footer&&this._footer.css("display","none")},_showEmptyIndicator:function(){this._emptyIndicator.css("display","block")},_hideEmptyIndicator:function(){this._emptyIndicator.css("display","none")},_listItemClick:function(a){var b=this._elements.length;if(b===0||a>=b)return;this._selectedIndex!==null&&this._elements[this._selectedIndex].deselect(),this._selectedIndex=a,this._elements[a].select(),this._clickCallback(a)}});var view=lib.util.extendNamespace("view");view.BookList=view.ListView.extend({init:function(a,b){this._loadMoreBtn=this._makeLoadMoreBtn(),this._loadMoreCallback=b,this._super({clickCallback:a,emptyLabel:lib.constants.strings.listBookLabels.emptyList,footer:this._loadMoreBtn,scroll:!0}),lib.dom.addClass(this._container,lib.constants.css.listBooks)},_makeLoadMoreBtn:function(){var a=lib.dom.create({tag:"li",options:{domClass:lib.constants.css.listLoadMore},text:lib.constants.strings.listBookLabels.loadMore,jquery:!0}),b=this;return lib.dom.click(a,function(){b._loadMoreClick()}),a},_loadMoreClick:function(){if(this._loading)return;this._loading=!0,this.setLoading(!0),this._loadMoreCallback()},addBooks:function(a,b){var c=this.size();this._loading&&(this.setLoading(!1),this._loading=!1);var d=[];for(var e in a)a.hasOwnProperty(e)&&d.push(new view.ListItemBook(a[e]));this.addElements(d),b||this._hideFooter()}});var view=lib.util.extendNamespace("view");view.OfferList=view.ListView.extend({init:function(a,b){var c=function(c){a(b,c)};this._super({clickCallback:c,emptyLabel:lib.constants.strings.listOffersLabels.emptyList,scroll:!0}),lib.dom.addClass(this._container,lib.constants.css.listBooks)},addOffers:function(a){this._loading&&this.setLoading(!1);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(new view.ListItemOffer(a[c]));this.addElements(b)}});var view=lib.util.extendNamespace("view");view.KeywordInputView=view.View.extend({init:function(a){this._empty=!0,this._searchCallback=a,this._textField=lib.dom.create({tag:"input",options:{domClass:[lib.constants.css.keywordInputTextField,lib.constants.css.empty],type:"text",value:lib.constants.strings.keywordInput.defaultText},jquery:!0});var b=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.keywordInputTextFieldWrapper},children:this._textField});this._submitButton=lib.dom.create({tag:"button",options:{domClass:lib.constants.css.keywordInputSubmit,type:"submit"},jquery:!0,text:lib.constants.strings.keywordInput.submit}),this._form=lib.dom.create({tag:"form",options:{domClass:lib.constants.css.keywordInputForm},children:[b,this._submitButton],jquery:!0}),this._container=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.keywordInput},children:this._form});var c=this;this._textField.focus(function(){c._onTextFieldEnterFocus()}).blur(function(){c._onTextFieldLoseFocus()}),this._form.submit(function(a){c._onSubmit(a)})},_onSubmit:function(a){a.preventDefault();if(this._empty)return;var b=this._textField.val();lib.util.empty(b)||(this._textField.blur(),this._searchCallback(b))},_onTextFieldEnterFocus:function(){this._empty&&(this._textField.val(""),lib.dom.removeClass(this._textField,lib.constants.css.empty),this._empty=!1)},_onTextFieldLoseFocus:function(){lib.util.empty(this._textField.val())&&(this._empty=!0,lib.dom.addClass(this._textField,lib.constants.css.empty),this._textField.val(lib.constants.strings.keywordInput.defaultText))}});var view=lib.util.extendNamespace("view");view.ScrollBar=view.View.extend({init:function(a,b){var c=this;view.ScrollBar.systemScrollBarWidth||this._findScrollBarWidth(),this._parent=$(a),this._wrapper=b?b:this._parent.children(),this._scrollPane=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.scrollBarParent},jquery:!0}).css("right",-view.ScrollBar.systemScrollBarWidth+"px"),this._scrollPane=this._parent.wrapInner(this._scrollPane).css("overflow-y","hidden").children(),this._handle=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.scrollBarHandle},jquery:!0}),this._gutter=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.scrollBarGutter},jquery:!0,children:this._handle}),this._parent.append(this._gutter),this._mouseEventState={},this._scrollPosition=0,this._handleHeight=0,this._gutterHeight=0,this._mouseMoveFunction=function(a){c._mouseMove(a)},this._mouseUpFunction=function(a){c._mouseUp(a)}},build:function(){var a=this;this.redraw(),this._scrollPane.scroll(function(){a._scrollEvent.apply(a,arguments)}),this._parent.scroll(function(){a._preventParentScroll()}),this._handle.mousedown(function(){a._mouseDown.apply(a,arguments)})},redraw:function(){this._setHeights(),this._setScrollPosition(),this._drawHandle(),this._positionHandle()},_setHeights:function(){this._height=this._parent.height(),this._realHeight=this._wrapper.outerHeight(),this._gutterHeight=this._gutter.height();var a=this._realHeight===0||this._realHeight<=this._height?this._gutterHeight:Math.round(this._height/this._realHeight*this._gutterHeight);a<lib.constants.scrollBar.minHandleSize&&(a=lib.constants.scrollBar.minHandleSize),this._handleHeight=a},_setScrollPosition:function(){this._scrollPosition=this._scrollPane.scrollTop()},_getOffsetHeight:function(){return this._realHeight-this._height},_getHandleOffsetHeight:function(){return this._gutterHeight-this._handleHeight},_positionHandle:function(){var a=this._scrollPosition/this._getOffsetHeight(),b=this._getHandleOffsetHeight()*a;this._handle.css("top",b+"px")},_drawHandle:function(){this._handleHeight===this._gutterHeight?(this._handle.css("visibility","hidden"),this._gutter.css("visibility","hidden")):(this._gutter.css("visibility","visible"),this._handle.css("visibility","visible"),this._handle.css("height",this._handleHeight+"px"))},_scrollDistanceY:function(a){var b=this._scrollPosition+a;if(a>0){var c=this._getOffsetHeight();if(this._scrollPosition===c)return;c<b&&(b=c)}else{if(this._scrollPosition===0)return;b<0&&(b=0)}return this._scrollPane.scrollTop(b),this._setScrollPosition(),b},_mouseMove:function(a){a.preventDefault();var b=this._mouseEventState,c=a.pageY-b.globalPX,d=(b.gutterPX+c)/(this._gutterHeight-this._handleHeight),e=this._scrollPosition-(this._realHeight-this._height)*d;this._scrollDistanceY(-e),this._positionHandle()},_mouseDown:function(a){a.preventDefault();var b=this;$(window).mousemove(this._mouseMoveFunction).mouseup(b._mouseUpFunction);var c=this._mouseEventState;c.gutterPX=parseInt(this._handle.css("top")),c.globalPX=a.pageY},_mouseUp:function(a){$(window).unbind("mousemove",this._mouseMoveFunction).unbind("mouseup",this._mouseUp)},_mouseWheelMove:function(a,b,c,d){if(d===0)return;var e=this._scrollDistanceY(-d*lib.constants.scrollBar.mouseWheelSpeed);this._positionHandle(),e===0&&a.preventDefault()},_scrollEvent:function(){this._setScrollPosition(),this._positionHandle()},_preventParentScroll:function(){this._parent.scrollLeft()!==0&&this._parent.scrollLeft(0),this._parent.scrollTop()!==0&&this._parent.scrollTop(0)},_findScrollBarWidth:function(){var a=30,b=$('<div style="width:'+a+'px; height:90px; overflow-y:scroll; visibility:hidden;">'+'<div style="height:100px;"></div></div>');$("body").append(b);var c=b.children().width();b.remove(),view.ScrollBar.systemScrollBarWidth=a-c}});var view=lib.util.extendNamespace("view");view.TabView=view.View.extend({init:function(){var a=this;this._tabs=[],this._tabContent=[],this._tabWell=this._makeTabWell(),this._selectedIndex=-1,this._contentContainer=this._makeContentContainer(),this._emptyIndicator=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.emptyIndicator},text:lib.constants.strings.tabLabels.empty,jquery:!0}),this._container=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.tabView},children:[this._emptyIndicator,this._tabWell,this._contentContainer]}),this.setEmpty(!0),this._tabWell.on("click","li",function(b){var c=$(this).index();a.showTab(c)})},addTab:function(a,b){var c=lib.dom.create({tag:"li",options:{domClass:lib.constants.css.tabButton},text:a});this._tabWell.append(c);var d=b.getDomNode();lib.dom.addClass(d,lib.constants.css.tabContent),this._contentContainer.append(d),this._tabs.push(c),this._tabContent.push(b)},setEmpty:function(a){a?(this._emptyIndicator.show(),this._tabWell.hide(),this._contentContainer.hide()):(this._emptyIndicator.hide(),this._tabWell.show(),this._contentContainer.show())},showTab:function(a){if(a===this._selectedIndex)return;this._selectedIndex>=0&&this._deselectTab(this._selectedIndex),this._selectTab(a),this._selectedIndex=a},_makeTabWell:function(){return lib.dom.create({tag:"ul",options:{domClass:lib.constants.css.tabWell},jquery:!0})},_makeContentContainer:function(){return lib.dom.create({tag:"div",options:{domClass:lib.constants.css.tabContentContainer},jquery:!0})},_deselectTab:function(a){var b=this._tabContent[a];lib.dom.removeClass(this._tabs[a],lib.constants.css.selected),lib.dom.removeClass(b.getDomNode(),lib.constants.css.selected),b.redraw()},_selectTab:function(a){var b=this._tabContent[a];lib.dom.addClass(this._tabs[a],lib.constants.css.selected),lib.dom.addClass(b.getDomNode(),lib.constants.css.selected),b.redraw()},build:function(){for(var a=0;a<this._tabContent.length;a++)this._tabContent[a].build()},redraw:function(){for(var a=0;a<this._tabContent.length;a++)this._tabContent[a].redraw()}});var view=lib.util.extendNamespace("view");view.TwoColumnView=view.View.extend({init:function(a,b,c){this.LEFT=0,this.RIGHT=1,this._columnFocus=this.LEFT,this._singleColumn=!1,this._fluidFixed=!1,this._fluidSize=null,this._gapWidth=c?c:0,this._left=a,this._right=b,this._leftDom=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.twoColumnViewColumn},children:[a.view.getDomNode(),a.switchColumnView],jquery:!0}),this._rightDom=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.twoColumnViewColumn},children:[$(b.view.getDomNode()).css("left",this._gapWidth+"px"),b.switchColumnView],jquery:!0}),b.view.build(),a.view.build(),this._wrapper=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.twoColumnViewShifter},children:[this._leftDom,this._rightDom],jquery:!0}),this._container=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.twoColumnView},children:this._wrapper,jquery:!0}),this._leftDom.css({"min-width":a.minWidth+"px",right:100-a.percent+"%"}),this._rightDom.css({"min-width":b.minWidth+"px",left:100-b.percent+"%"});var d=this;$(window).resize(function(){d.redraw()});var e=function(){d.setColumnFocus(d.LEFT)},f=function(){d.setColumnFocus(d.RIGHT)};a.switchColumnView&&lib.dom.click(a.switchColumnView,f),b.switchColumnView&&lib.dom.click(b.switchColumnView,e)},LEFT:0,RIGHT:1,setColumnFocus:function(a){this._columnFocus=a,this._singleColumn&&this._wrapper.animate({left:-100*a+"%"},200)},redraw:function(){var a=this._container.width(),b=this._left,c=this._right;if(a<b.minWidth+c.minWidth+this._gapWidth)this._singleColumn||($(this._right.view.getDomNode()).css("left","0px"),this._wrapper.css({width:"200%",left:-100*this._columnFocus+"%"}),this._singleColumn=!0,this._fluidFixed=!1,this._leftDom.css("right","50%"),this._setMinWidth(this._leftDom),this._setMinWidth(this._rightDom),this._rightDom.css("left","50%"),this._showSwitchColumnView(this._right),this._showSwitchColumnView(this._left));else{if(this._singleColumn){this._wrapper.css({width:"100%",left:0}),$(this._right.view.getDomNode()).css("left",this._gapWidth+"px"),this._setMinWidth(this._leftDom,this._left.minWidth),this._setMinWidth(this._rightDom,this._right.minWidth),this._leftDom.css("right",100-this._left.percent+"%"),this._rightDom.css("left",100-this._right.percent+"%"),this._singleColumn=!1,this._hideSwitchColumnView(this._right),this._hideSwitchColumnView(this._left),this.redraw();return}if(!this._fluidFixed)this._leftDom.width()===b.minWidth?this._sizeColumn(this.RIGHT):this._rightDom.width()===c.minWidth+this._gapWidth&&this._sizeColumn(this.LEFT);else{var d,e,f,g,h,i;this._fluidSide===this.LEFT?(d=this._rightDom,e=this._right,i=this._gapWidth,f=this._leftDom,g=this._left,h="right"):(d=this._leftDom,e=this._left,i=0,f=this._rightDom,g=this._right,h="left"),d.width()>e.minWidth+i&&(this._fluidFixed=!1,f.css(h,100-g.percent+"%"))}}this._left.view.redraw(),this._right.view.redraw()},_sizeColumn:function(a){this._fluidFixed=!0,this._fluidSide=a;var b,c,d;a===this.LEFT?(b=this._right.minWidth,c=this._leftDom,d="right"):(b=this._left.minWidth,c=this._rightDom,d="left"),c.css(d,b+"px")},_showSwitchColumnView:function(a){if(a.switchColumnView){var b=a.switchColumnView;b.css("display","block");var c=b.outerHeight();$(a.view.getDomNode()).css("bottom",c+"px")}},_hideSwitchColumnView:function(a){if(a.switchColumnView){var b=a.switchColumnView,c=b.outerHeight();$(a.view.getDomNode()).css("bottom","0px"),b.css("display","none")}},_setMinWidth:function(a,b){b||(b=0),a.css("min-width",b+"px")}});var view=lib.util.extendNamespace("view");view.BookDetails=view.View.extend({init:function(){this._image=lib.dom.create({tag:"div",options:{domClass:[lib.constants.css.bookImage,lib.constants.css.bookSizeLarge]},jquery:!0});var a=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.bookDetailsImageWell}});this._metaData=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.bookDetailsData},jquery:!0}),this._container=lib.dom.create({tag:"div",options:{domClass:[lib.constants.css.bookDetails,lib.constants.css.tabContent]},children:[this._image,a,this._metaData]}),this._scrollbar=new view.ScrollBar(this._container,this._metaData)},setBook:function(a){this._book=a;var b=lib.util.empty(a.imageLarge)?lib.constants.resources.images.ajaxLoaderOnWhite:a.imageLarge;this._image.css({"background-image":'url("'+b+'")'}),this._metaData.children().remove();var c=[],d=["author","isbn10","isbn13","edition","publisher","publishedDate","msrp","pages"];c.push(lib.dom.create({tag:"div",options:{domClass:lib.constants.css.bookDetailsTitle},text:a.title}));for(var e in d)if(d.hasOwnProperty(e)){var f=d[e],g=a[f];if(lib.util.empty(g))continue;var h=lib.constants.strings.bookMetaNames[f];c.push(this._createMetaRow(h,g))}this._metaData.append(c)},updateImage:function(a){var b=lib.util.empty(a.imageLarge)?a.imageSmall:a.imageLarge;this._image.css({"background-image":'url("'+b+'")'})},_createMetaRow:function(a,b){var c=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.bookDetailsLabel},text:a}),d=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.bookDetailsText},text:b}),e=lib.dom.create({tag:"div",options:{domClass:lib.constants.css.bookDetailsRow},children:[c,d]});return e},build:function(){this._scrollbar.build()},redraw:function(){this._scrollbar.redraw()}});var controller=lib.util.extendNamespace("controller");controller.BookData=lib.Class.extend({init:function(){this._requestSet={},this._bookSetId=0,this._books=[],this._searchTerms=null,this._currentPage=1,this._maxPages=null,this._currentBookIndex=0,lib.api.init(lib.config.apiKey,66,130),this._api=lib.api;var a=this;this._fnWrappers={addBooks:function(b){a._addBooks(b)},addLargeBookImage:function(b){a._addLargeBookImage(b)},loadOffers:function(b){a._loadOffers(b)}}},search:function(a,b){this._bookSetId++,this._searchTerms=a,this._currentPage=1,this._maxPages=1,this._books=[];var c=this._api.search(a,this._api.IMG_SIZE_SM,this._currentPage,this._fnWrappers.addBooks);this._createRequestSet(c,null,b)},loadMore:function(a){this._currentPage++;var b=this._api.search(this._searchTerms,this._api.IMG_SIZE_SM,this._currentPage,this._fnWrappers.addBooks);this._createRequestSet(b,null,a)},hasMore:function(){return this._currentPage<this._maxPages},getBook:function(a){return a<this._books.length?(this._currentBookIndex=a,this._books[a]):null},getCurrentBook:function(){return this._books[this._currentBookIndex]},loadLargeBookImage:function(a,b){var c=this._books[a];if(c.imageLarge)b(c);else{var d=this._api.bookInfo(c.isbn10,this._api.IMG_SIZE_LG,this._fnWrappers.addLargeBookImage);this._createRequestSet(d,a,b)}},loadOffers:function(a,b){var c=this._books[a];if(c.offers)b(c);else{var d=this._api.bookPrices(c.isbn10,this._fnWrappers.loadOffers);this._createRequestSet(d,a,b)}},_getRequestSet:function(a){var b=this._requestSet[a];return delete this._requestSet[a],b.bookSet===this._bookSetId?b:null},_createRequestSet:function(a,b,c){this._requestSet[a]={bookSet:this._bookSetId,bookIndex:b,callback:c}},_addLargeBookImage:function(a){var b=this._getRequestSet(a.id),c;b&&(c=this._books[b.bookIndex],a.status?c.imageLarge=a.data.imageLarge:this._currentBookIndex===b.bookIndex&&this._logError("There was an error connecting to the server"),this._currentBookIndex===b.bookIndex&&b.callback(c))},_addBooks:function(a){var b=this._getRequestSet(a.id),c=null,d=!1;b&&(a.status?a.data===null?d=!1:(this._maxPages=a.data.pages,a.data.page<a.data.pages&&(d=!0),this._books=this._books.concat(a.data.books),c=a.data.books):(this._logError("There was an error connecting to the server"),this._currentPage=this._currentPage===1?1:this._currentPage-1,d=!0),b.callback(c,d))},_loadOffers:function(a){var b=this._getRequestSet(a.id),c;b&&(a.status?a.data===null?c=null:(c=this._books[b.bookIndex],c.offers=a.data):this._logError("There was an error connecting to the server"),this._currentBookIndex===b.bookIndex&&b.callback(c))},_logError:function(a){alert(a)}});var controller=lib.util.extendNamespace("controller");controller.ListingOpener=lib.Class.extend({openUrl:function(a){var b=[];lib.config.preOpenOfferFn&&(b=lib.config.preOpenOfferFn(),b.length>3&&(b=b.slice(0,3)));for(var c=0;c<b.length;c++)a+="&c"+(c+1)+encodeURI(b[c]);window.open(a)}});var controller=lib.util.extendNamespace("controller");return controller.MainPage=lib.Class.extend({init:function(a){this.bookData=new lib.controller.BookData;var b=this,c=function(a,c){b._offerSelected(a,c)},d=function(a){b._bookSelected(a)},e=function(){b._loadMore()};this._getHighResImg=function(a){b.views.bookDetails.updateImage(a)};var f=function(a){return b._startSearch(a)};this.listingOpener=new lib.controller.ListingOpener,this.views={tabView:new lib.view.TabView,bookDetails:new lib.view.BookDetails,newPrices:new lib.view.OfferList(c,lib.constants.Condition.NEW),usedPrices:new lib.view.OfferList(c,lib.constants.Condition.USED),ebookPrices:new lib.view.OfferList(c,lib.constants.Condition.EBOOK),list:new lib.view.BookList(d,e),columnView:null,searchView:new lib.view.KeywordInputView(f)},this.views.tabView.addTab("Info",this.views.bookDetails),this.views.tabView.addTab("New",this.views.newPrices),this.views.tabView.addTab("Used",this.views.usedPrices),this.views.tabView.addTab("eBook",this.views.ebookPrices),this.views.columnView=new lib.view.TwoColumnView({view:this.views.list,minWidth:400,percent:40},{view:this.views.tabView,minWidth:400,percent:60,switchColumnView:lib.dom.create({tag:"div",options:{domClass:lib.constants.css.twoColumnViewSwitchButton},text:"Back To All Books",jquery:!0})},30),lib.dom.setId(this.views.searchView.getDomNode(),"topRow"),lib.dom.setId(this.views.columnView.getDomNode(),"bottomRow"),$(a).append(this.views.columnView.getDomNode()),$(a).append(this.views.searchView.getDomNode()),this.views.columnView.redraw(),this.views.tabView.showTab(0)},_startSearch:function(a){var b=this.views,c=this,d=function(a,b){c._search(a,b)};try{b.list.clearElements(a),b.list.setLoading(!0),b.tabView.setEmpty(!0),this.bookData.search(a,d),b.columnView.setColumnFocus(lib.view.TwoColumnView.prototype.LEFT)}catch(e){console.log(e)}return!1},_offerSelected:function(a,b){var c=this.bookData.getCurrentBook().offers;this.listingOpener.openUrl(c.types[a][b].link)},_getOffers:function(a){var b=a.offers,c=this.views;c.newPrices.addOffers(b.types[lib.constants.Condition.NEW]),c.usedPrices.addOffers(b.types[lib.constants.Condition.USED]),c.ebookPrices.addOffers(b.types[lib.constants.Condition.EBOOK])},_bookSelected:function(a){var b=this.views,c=this.bookData.getBook(a),d=this,e=function(a){d._getOffers(a)};b.bookDetails.setBook(c),b.tabView.setEmpty(!1),b.bookDetails.redraw();var f=[b.newPrices,b.usedPrices,b.ebookPrices];c.imageLarge==null&&this.bookData.loadLargeBookImage(a,this._getHighResImg);if(c.offers==null){this.bookData.loadOffers(a,e);for(var g in f)f[g].clearElements(),f[g].setLoading(!0)}else{for(var g in f)f[g].clearElements();e(c)}b.columnView.setColumnFocus(lib.view.TwoColumnView.prototype.RIGHT)},_loadMore:function(){var a=this,b=function(b,c){a._search(b,c)};this.bookData.loadMore(b)},_search:function(a,b){this.views.list.addBooks(a,b)}}),{init:lib.init}}()